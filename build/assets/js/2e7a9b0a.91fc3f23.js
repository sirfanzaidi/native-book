"use strict";(self.webpackChunkphysical_ai_humanoid_robotics_book=self.webpackChunkphysical_ai_humanoid_robotics_book||[]).push([[4],{8453:function(e,n,s){s.d(n,{R:function(){return r},x:function(){return a}});var i=s(6540);const o={},t=i.createContext(o);function r(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(t.Provider,{value:n},e.children)}},9798:function(e,n,s){s.r(n),s.d(n,{assets:function(){return l},contentTitle:function(){return a},default:function(){return h},frontMatter:function(){return r},metadata:function(){return i},toc:function(){return d}});var i=JSON.parse('{"id":"module-2-digital-twin/05-ros2-gazebo-bridge","title":"Chapter 5 - ROS 2 and Gazebo Integration","description":"Introduction","source":"@site/docs/02-module-2-digital-twin/02-ros2-gazebo-bridge.md","sourceDirName":"02-module-2-digital-twin","slug":"/module-2-digital-twin/05-ros2-gazebo-bridge","permalink":"/native-book/module-2-digital-twin/05-ros2-gazebo-bridge","draft":false,"unlisted":false,"editUrl":"https://github.com/native-book/native-book/tree/main/docs/02-module-2-digital-twin/02-ros2-gazebo-bridge.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"05-ros2-gazebo-bridge","title":"Chapter 5 - ROS 2 and Gazebo Integration","sidebar_label":"Chapter 5: ROS 2 + Gazebo"},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 4: Gazebo Basics","permalink":"/native-book/module-2-digital-twin/04-gazebo-fundamentals"},"next":{"title":"Chapter 6: Isaac Basics","permalink":"/native-book/module-3-ai-perception/06-isaac-fundamentals"}}'),o=s(4848),t=s(8453);const r={id:"05-ros2-gazebo-bridge",title:"Chapter 5 - ROS 2 and Gazebo Integration",sidebar_label:"Chapter 5: ROS 2 + Gazebo"},a="Chapter 5: ROS 2 and Gazebo Integration",l={},d=[{value:"Introduction",id:"introduction",level:2},{value:"The Bridge Architecture",id:"the-bridge-architecture",level:3},{value:"Why This Matters",id:"why-this-matters",level:3},{value:"How ROS 2 - Gazebo Integration Works",id:"how-ros-2---gazebo-integration-works",level:2},{value:"Three Key Components",id:"three-key-components",level:3},{value:"Plugin System",id:"plugin-system",level:3},{value:"Publishing Sensor Data from Gazebo",id:"publishing-sensor-data-from-gazebo",level:2},{value:"Subscribing to Sensor Data",id:"subscribing-to-sensor-data",level:3},{value:"Expected Output",id:"expected-output",level:3},{value:"Sending Commands to Gazebo",id:"sending-commands-to-gazebo",level:2},{value:"Publishing Joint Commands",id:"publishing-joint-commands",level:3},{value:"Expected Output",id:"expected-output-1",level:3},{value:"Real vs Simulated: The Same Code",id:"real-vs-simulated-the-same-code",level:2},{value:"Topics: Standard Message Types",id:"topics-standard-message-types",level:2},{value:"Summary",id:"summary",level:2}];function c(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"chapter-5-ros-2-and-gazebo-integration",children:"Chapter 5: ROS 2 and Gazebo Integration"})}),"\n",(0,o.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,o.jsxs)(n.p,{children:["In Chapter 4, you learned how to create Gazebo worlds and robots. But how do you ",(0,o.jsx)(n.strong,{children:"control robots in simulation using ROS 2"}),"?"]}),"\n",(0,o.jsxs)(n.p,{children:["This chapter shows you the critical bridge: connecting ROS 2 nodes to Gazebo robots via ",(0,o.jsx)(n.strong,{children:"plugins and middleware"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"the-bridge-architecture",children:"The Bridge Architecture"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"[ROS 2 Control Node]         [Gazebo Simulator]\n        |                           |\n        |--- Publish Commands ------|\n        |   /joint_commands topic   |\n        |                    [Robot Arm]\n        |                    [Physics]\n        |                    [Sensors]\n        |<-- Publish Sensor Data ----|\n        |   /joint_states topic      |\n        |   /camera/image_raw topic  |\n        |   /lidar/scan topic        |\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The beauty: ",(0,o.jsx)(n.strong,{children:"Your ROS 2 code doesn't know or care if it's controlling a real robot or a simulated one."})]}),"\n",(0,o.jsx)(n.h3,{id:"why-this-matters",children:"Why This Matters"}),"\n",(0,o.jsx)(n.p,{children:"Being able to:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Develop control algorithms in simulation"}),"\n",(0,o.jsx)(n.li,{children:"Test them thoroughly"}),"\n",(0,o.jsx)(n.li,{children:"Deploy to real robots without code changes"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"This is the core workflow of professional robotics development."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Source"}),": Open Robotics. (2024). ",(0,o.jsx)(n.em,{children:"Gazebo and ROS 2 Integration"}),". Retrieved from ",(0,o.jsx)(n.a,{href:"https://gazebosim.org/docs/garden/ros2_integration/",children:"https://gazebosim.org/docs/garden/ros2_integration/"})]}),"\n",(0,o.jsx)(n.h2,{id:"how-ros-2---gazebo-integration-works",children:"How ROS 2 - Gazebo Integration Works"}),"\n",(0,o.jsx)(n.h3,{id:"three-key-components",children:"Three Key Components"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Gazebo Plugins"}),": Add ROS 2 publishing/subscribing to simulation"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"ROS 2 Topics"}),": Bridge between control code and simulation"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Messages"}),": Standard formats for commands and sensor data"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"plugin-system",children:"Plugin System"}),"\n",(0,o.jsx)(n.p,{children:"Gazebo plugins allow you to:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Publish sensor data to ROS 2 topics"}),"\n",(0,o.jsx)(n.li,{children:"Subscribe to ROS 2 topics for commands"}),"\n",(0,o.jsx)(n.li,{children:"Execute custom logic during simulation steps"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-xml",children:'<plugin filename="libgazebo_ros_joint_state_publisher.so"\n        name="joint_state_publisher">\n    <topic_name>joint_states</topic_name>\n    <update_rate>10</update_rate>\n</plugin>\n'})}),"\n",(0,o.jsxs)(n.p,{children:["This simple XML tells Gazebo to publish joint state information on the ROS 2 topic ",(0,o.jsx)(n.code,{children:"joint_states"})," at 10 Hz."]}),"\n",(0,o.jsx)(n.h2,{id:"publishing-sensor-data-from-gazebo",children:"Publishing Sensor Data from Gazebo"}),"\n",(0,o.jsx)(n.p,{children:"Gazebo sensors (cameras, LiDAR, IMU) automatically publish to ROS 2 topics via plugins."}),"\n",(0,o.jsx)(n.h3,{id:"subscribing-to-sensor-data",children:"Subscribing to Sensor Data"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\"\"\"\nSubscribe to Gazebo Sensor Data\nReceive sensor readings from simulated robot\n\"\"\"\n\nimport rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import JointState, LaserScan\nfrom geometry_msgs.msg import TransformStamped\n\n\nclass SensorSubscriber(Node):\n    def __init__(self):\n        super().__init__('sensor_subscriber')\n\n        # Subscribe to joint states (published by Gazebo)\n        self.joint_sub = self.create_subscription(\n            JointState,\n            '/joint_states',\n            self.joint_state_callback,\n            10)\n\n        # Subscribe to LiDAR scan (if robot has LiDAR)\n        self.lidar_sub = self.create_subscription(\n            LaserScan,\n            '/lidar/scan',\n            self.lidar_callback,\n            10)\n\n        self.get_logger().info('Sensor subscriber started')\n\n    def joint_state_callback(self, msg):\n        # Receive joint positions from Gazebo\n        self.get_logger().info(\n            f'Joint positions: {[f\"{p:.2f}\" for p in msg.position]}')\n\n    def lidar_callback(self, msg):\n        # Receive LiDAR range data from Gazebo\n        closest_range = min(msg.ranges)\n        self.get_logger().info(\n            f'Closest obstacle: {closest_range:.2f}m')\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    subscriber = SensorSubscriber()\n    rclpy.spin(subscriber)\n    subscriber.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"What's happening"}),":"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Create subscription to ",(0,o.jsx)(n.code,{children:"/joint_states"})," topic (published by Gazebo)"]}),"\n",(0,o.jsx)(n.li,{children:"In callback, receive sensor data from simulation"}),"\n",(0,o.jsx)(n.li,{children:"Log joint positions and LiDAR ranges"}),"\n",(0,o.jsx)(n.li,{children:"Same code works with real robots!"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"expected-output",children:"Expected Output"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Terminal"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"[sensor_subscriber] Sensor subscriber started\n[sensor_subscriber] Joint positions: ['0.50', '1.05', '0.00']\n[sensor_subscriber] Closest obstacle: 2.34m\n[sensor_subscriber] Joint positions: ['0.51', '1.04', '0.02']\n[sensor_subscriber] Closest obstacle: 2.31m\n"})}),"\n",(0,o.jsx)(n.h2,{id:"sending-commands-to-gazebo",children:"Sending Commands to Gazebo"}),"\n",(0,o.jsx)(n.p,{children:"To control the simulated robot, publish to ROS 2 command topics."}),"\n",(0,o.jsx)(n.h3,{id:"publishing-joint-commands",children:"Publishing Joint Commands"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\"\"\"\nSend Joint Commands to Gazebo\nControl robot arm in simulation\n\"\"\"\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import Float64MultiArray\nimport math\n\n\nclass JointCommandPublisher(Node):\n    def __init__(self):\n        super().__init__('joint_command_publisher')\n\n        # Publisher for joint commands\n        self.joint_cmd_pub = self.create_publisher(\n            Float64MultiArray,\n            '/joint_commands',\n            10)\n\n        # Timer to send commands periodically\n        self.timer = self.create_timer(0.1, self.publish_commands)\n        self.time_step = 0\n        self.get_logger().info('Joint command publisher started')\n\n    def publish_commands(self):\n        # Create command message\n        msg = Float64MultiArray()\n\n        # Sine wave motion for smooth robot movement\n        angle = math.sin(self.time_step / 50.0) * math.pi / 2.0\n\n        # Set joint positions (in radians)\n        msg.data = [angle, angle / 2.0, 0.0]  # 3 joints\n\n        # Publish to Gazebo\n        self.joint_cmd_pub.publish(msg)\n        self.get_logger().info(\n            f'Sent command: joints=[{angle:.2f}, {angle/2:.2f}, 0.00] rad')\n\n        self.time_step += 1\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    publisher = JointCommandPublisher()\n    rclpy.spin(publisher)\n    publisher.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"What's happening"}),":"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Create publisher to ",(0,o.jsx)(n.code,{children:"/joint_commands"})," topic"]}),"\n",(0,o.jsx)(n.li,{children:"Every 100ms, generate a command (sine wave motion)"}),"\n",(0,o.jsx)(n.li,{children:"Publish joint positions (in radians)"}),"\n",(0,o.jsx)(n.li,{children:"Gazebo receives and executes the commands"}),"\n",(0,o.jsx)(n.li,{children:"Robot arm moves realistically with physics"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"expected-output-1",children:"Expected Output"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Terminal"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"[joint_command_publisher] Joint command publisher started\n[joint_command_publisher] Sent command: joints=[0.00, 0.00, 0.00] rad\n[joint_command_publisher] Sent command: joints=[0.06, 0.03, 0.00] rad\n[joint_command_publisher] Sent command: joints=[0.12, 0.06, 0.00] rad\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Gazebo Window"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Robot arm smoothly moves"}),"\n",(0,o.jsx)(n.li,{children:"Joint angles follow the sine wave"}),"\n",(0,o.jsx)(n.li,{children:"Physics realistically simulates arm dynamics"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"real-vs-simulated-the-same-code",children:"Real vs Simulated: The Same Code"}),"\n",(0,o.jsx)(n.p,{children:"This is the key insight:"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Controlling a real robot"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"joint_cmd_pub = self.create_publisher(Float64MultiArray, '/joint_commands', 10)\nmsg.data = [angle, angle / 2.0, 0.0]\njoint_cmd_pub.publish(msg)  # Talks to real robot motors\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Controlling simulated robot"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"joint_cmd_pub = self.create_publisher(Float64MultiArray, '/joint_commands', 10)\nmsg.data = [angle, angle / 2.0, 0.0]\njoint_cmd_pub.publish(msg)  # Talks to Gazebo simulator\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Exactly the same code!"})," The only difference is which ROS 2 node is subscribed to ",(0,o.jsx)(n.code,{children:"/joint_commands"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"In simulation: Gazebo plugin receives the command"}),"\n",(0,o.jsx)(n.li,{children:"On hardware: Robot driver receives the command"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"topics-standard-message-types",children:"Topics: Standard Message Types"}),"\n",(0,o.jsx)(n.p,{children:"Common topics for robotics control:"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Topic"}),(0,o.jsx)(n.th,{children:"Message Type"}),(0,o.jsx)(n.th,{children:"Direction"}),(0,o.jsx)(n.th,{children:"Purpose"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"/joint_states"})}),(0,o.jsx)(n.td,{children:"JointState"}),(0,o.jsx)(n.td,{children:"Gazebo \u2192 Control"}),(0,o.jsx)(n.td,{children:"Read joint angles"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"/joint_commands"})}),(0,o.jsx)(n.td,{children:"Float64MultiArray"}),(0,o.jsx)(n.td,{children:"Control \u2192 Gazebo"}),(0,o.jsx)(n.td,{children:"Command joint angles"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"/cmd_vel"})}),(0,o.jsx)(n.td,{children:"Twist"}),(0,o.jsx)(n.td,{children:"Control \u2192 Gazebo"}),(0,o.jsx)(n.td,{children:"Command linear/angular velocity"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"/sensor/imu"})}),(0,o.jsx)(n.td,{children:"Imu"}),(0,o.jsx)(n.td,{children:"Gazebo \u2192 Control"}),(0,o.jsx)(n.td,{children:"IMU acceleration/rotation"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"/camera/image_raw"})}),(0,o.jsx)(n.td,{children:"Image"}),(0,o.jsx)(n.td,{children:"Gazebo \u2192 Control"}),(0,o.jsx)(n.td,{children:"Camera image"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"/lidar/scan"})}),(0,o.jsx)(n.td,{children:"LaserScan"}),(0,o.jsx)(n.td,{children:"Gazebo \u2192 Control"}),(0,o.jsx)(n.td,{children:"LiDAR range data"})]})]})]}),"\n",(0,o.jsx)(n.p,{children:"Using standard message types means code works seamlessly with real robots and other simulators."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Source"}),": ROS 2 Messages. (2024). Retrieved from ",(0,o.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Concepts/About-ROS-Interfaces.html",children:"https://docs.ros.org/en/humble/Concepts/About-ROS-Interfaces.html"})]}),"\n",(0,o.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,o.jsx)(n.p,{children:"In this chapter, you learned:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Bridge architecture"}),": How ROS 2 talks to Gazebo"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Plugins"}),": Enable ROS 2 communication in simulation"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Standard topics"}),": ",(0,o.jsx)(n.code,{children:"/joint_states"}),", ",(0,o.jsx)(n.code,{children:"/joint_commands"}),", sensor topics"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Sensor data"}),": Subscribe to simulate sensor readings"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Commands"}),": Publish to control simulated robots"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Sim-real identity"}),": Same code works everywhere"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Key Takeaway"}),": With ROS 2 and Gazebo, you develop and test robot control algorithms without expensive hardware."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Next steps"}),": In Chapter 6, we'll explore advanced simulation techniques: physics tuning, realistic sensors, and sim-to-real transfer."]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"References"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Open Robotics. (2024). ",(0,o.jsx)(n.em,{children:"Gazebo and ROS 2 Integration"}),". Retrieved from ",(0,o.jsx)(n.a,{href:"https://gazebosim.org/docs/garden/ros2_integration/",children:"https://gazebosim.org/docs/garden/ros2_integration/"})]}),"\n",(0,o.jsxs)(n.li,{children:["ROS 2 Standard Interfaces. (2024). Retrieved from ",(0,o.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Concepts/About-ROS-Interfaces.html",children:"https://docs.ros.org/en/humble/Concepts/About-ROS-Interfaces.html"})]}),"\n",(0,o.jsxs)(n.li,{children:["Gazebo ROS Package. (2024). ",(0,o.jsx)(n.em,{children:"gazebo_ros"}),". Retrieved from ",(0,o.jsx)(n.a,{href:"https://github.com/ros-simulation/gazebo_ros_pkg_v11",children:"https://github.com/ros-simulation/gazebo_ros_pkg_v11"})]}),"\n",(0,o.jsxs)(n.li,{children:["ROS 2 Control Framework. (2024). Retrieved from ",(0,o.jsx)(n.a,{href:"https://github.com/ros-controls/ros2_control",children:"https://github.com/ros-controls/ros2_control"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}}}]);