"use strict";(self.webpackChunkphysical_ai_humanoid_robotics_book=self.webpackChunkphysical_ai_humanoid_robotics_book||[]).push([[355],{3256:function(e,n,s){s.r(n),s.d(n,{assets:function(){return o},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return c},metadata:function(){return r},toc:function(){return d}});var r=JSON.parse('{"id":"module-1-ros2/02-services","title":"Chapter 2 - ROS 2 Services & Actions","description":"Introduction","source":"@site/docs/01-module-1-ros2/02-services.md","sourceDirName":"01-module-1-ros2","slug":"/module-1-ros2/02-services","permalink":"/native-book/module-1-ros2/02-services","draft":false,"unlisted":false,"editUrl":"https://github.com/native-book/native-book/tree/main/docs/01-module-1-ros2/02-services.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"02-services","title":"Chapter 2 - ROS 2 Services & Actions","sidebar_label":"Chapter 2: Services"},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 1: Architecture","permalink":"/native-book/module-1-ros2/01-introduction"},"next":{"title":"Chapter 3: Advanced Nodes","permalink":"/native-book/module-1-ros2/03-advanced-nodes"}}'),i=s(4848),t=s(8453);const c={id:"02-services",title:"Chapter 2 - ROS 2 Services & Actions",sidebar_label:"Chapter 2: Services"},l="Chapter 2: ROS 2 Services & Actions",o={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Why Services?",id:"why-services",level:3},{value:"Services vs Topics: When to Use Each",id:"services-vs-topics-when-to-use-each",level:3},{value:"Understanding the Service Pattern",id:"understanding-the-service-pattern",level:2},{value:"The Request-Response Flow",id:"the-request-response-flow",level:3},{value:"Creating Service Definitions",id:"creating-service-definitions",level:3},{value:"Creating Your First Service",id:"creating-your-first-service",level:2},{value:"Simple Service Server",id:"simple-service-server",level:3},{value:"Simple Service Client",id:"simple-service-client",level:3},{value:"Expected Output",id:"expected-output",level:3},{value:"Services vs Topics: A Robot Example",id:"services-vs-topics-a-robot-example",level:2},{value:"Summary",id:"summary",level:2}];function a(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"chapter-2-ros-2-services--actions",children:"Chapter 2: ROS 2 Services & Actions"})}),"\n",(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsxs)(n.p,{children:["In Chapter 1, you learned about ",(0,i.jsx)(n.strong,{children:"Pub/Sub"})," messaging: a one-way, asynchronous communication pattern where publishers send data to topics and subscribers receive it."]}),"\n",(0,i.jsxs)(n.p,{children:["But what happens when you need a ",(0,i.jsx)(n.strong,{children:"request-response"})," interaction? What if one node needs to ask another node a question and wait for an answer?"]}),"\n",(0,i.jsxs)(n.p,{children:["In this chapter, you'll learn about ",(0,i.jsx)(n.strong,{children:"Services"}),", the ROS 2 mechanism for synchronous, request-response communication."]}),"\n",(0,i.jsx)(n.h3,{id:"why-services",children:"Why Services?"}),"\n",(0,i.jsx)(n.p,{children:"Services solve different problems than topics:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Topics (Pub/Sub)"}),': "I\'m publishing sensor data continuously"']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Services (Request-Response)"}),': "I need to calculate something right now and get the result"']}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Common use cases for services:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Asking a robot to move to a specific position"}),"\n",(0,i.jsx)(n.li,{children:"Requesting calculations (e.g., inverse kinematics)"}),"\n",(0,i.jsx)(n.li,{children:"Setting configuration parameters"}),"\n",(0,i.jsx)(n.li,{children:"Triggering one-time actions"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Source"}),": ROS 2 Documentation Contributors. (2024). ",(0,i.jsx)(n.em,{children:"Understanding ROS 2 Services"}),". Retrieved from ",(0,i.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Understanding-ROS2-Services.html",children:"https://docs.ros.org/en/humble/Tutorials/Understanding-ROS2-Services.html"})]}),"\n",(0,i.jsx)(n.h3,{id:"services-vs-topics-when-to-use-each",children:"Services vs Topics: When to Use Each"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Aspect"}),(0,i.jsx)(n.th,{children:"Topics (Pub/Sub)"}),(0,i.jsx)(n.th,{children:"Services (Request-Response)"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Pattern"})}),(0,i.jsx)(n.td,{children:"One-way streaming"}),(0,i.jsx)(n.td,{children:"Two-way synchronous"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Timing"})}),(0,i.jsx)(n.td,{children:"Asynchronous"}),(0,i.jsx)(n.td,{children:"Synchronous (wait for reply)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Use Case"})}),(0,i.jsx)(n.td,{children:"Sensors, continuous data"}),(0,i.jsx)(n.td,{children:"Commands, calculations"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Example"})}),(0,i.jsx)(n.td,{children:"Publishing joint angles"}),(0,i.jsx)(n.td,{children:"Asking for IK solution"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Blocking"})}),(0,i.jsx)(n.td,{children:"Non-blocking"}),(0,i.jsx)(n.td,{children:"Caller waits for response"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"understanding-the-service-pattern",children:"Understanding the Service Pattern"}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.strong,{children:"service"})," consists of three components:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Service Server"}),": Node that provides a service (answers requests)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Service Client"}),": Node that calls the service (asks questions)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Service Definition"}),": The request and response data structures"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"the-request-response-flow",children:"The Request-Response Flow"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Client (Robot Arm)         Server (IK Solver)\n      |                          |\n      | -- Request: Target Pos --\x3e|\n      |   (x=1.0, y=2.0, z=0.5)  |\n      |                          |\n      |                     [Calculating...]\n      |                          |\n      | <-- Response: Joint Angles |\n      |   (\u03b81=45\xb0, \u03b82=30\xb0, \u03b83=60\xb0)|\n      |                          |\n"})}),"\n",(0,i.jsx)(n.p,{children:"The client blocks and waits for the server to respond. This is different from Pub/Sub, where the publisher doesn't know or care who receives the data."}),"\n",(0,i.jsx)(n.h3,{id:"creating-service-definitions",children:"Creating Service Definitions"}),"\n",(0,i.jsxs)(n.p,{children:["Services need a ",(0,i.jsx)(n.code,{children:".srv"})," file that defines the request and response:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# Example: Inverse Kinematics Service\nfloat64[] target_position  # Request: desired (x, y, z)\n---\nfloat64[] joint_angles     # Response: calculated angles\n"})}),"\n",(0,i.jsxs)(n.p,{children:["For simplicity, this chapter uses standard message types (like ",(0,i.jsx)(n.code,{children:"std_srvs.srv.Trigger"}),") that come with ROS 2."]}),"\n",(0,i.jsx)(n.h2,{id:"creating-your-first-service",children:"Creating Your First Service"}),"\n",(0,i.jsx)(n.h3,{id:"simple-service-server",children:"Simple Service Server"}),"\n",(0,i.jsx)(n.p,{children:"A service server listens for requests and sends responses:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\"\"\"\nSimple ROS 2 Service Server\nProvides a service that adds two numbers\n\"\"\"\n\nimport rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\n\nclass MinimalService(Node):\n    def __init__(self):\n        super().__init__('minimal_service')\n        # Create service: name='add_two_ints', type=AddTwoInts, callback\n        self.srv = self.create_service(\n            AddTwoInts,\n            'add_two_ints',\n            self.add_two_ints_callback)\n        self.get_logger().info('Service server started')\n\n    def add_two_ints_callback(self, request, response):\n        # request.a and request.b are the inputs\n        response.sum = request.a + request.b\n        self.get_logger().info(\n            f'Incoming request: {request.a} + {request.b} = {response.sum}')\n        return response  # Send back the response\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    minimal_service = MinimalService()\n    rclpy.spin(minimal_service)\n    minimal_service.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"What's happening"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"create_service()"})," registers a service named ",(0,i.jsx)(n.code,{children:"add_two_ints"})]}),"\n",(0,i.jsxs)(n.li,{children:["When a client calls this service, ",(0,i.jsx)(n.code,{children:"add_two_ints_callback()"})," is invoked"]}),"\n",(0,i.jsxs)(n.li,{children:["The callback receives the ",(0,i.jsx)(n.code,{children:"request"})," object, does computation, and returns ",(0,i.jsx)(n.code,{children:"response"})]}),"\n",(0,i.jsx)(n.li,{children:"The client receives the response and continues execution"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"simple-service-client",children:"Simple Service Client"}),"\n",(0,i.jsx)(n.p,{children:"A service client calls the service and waits for the response:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\"\"\"\nSimple ROS 2 Service Client\nCalls the add_two_ints service\n\"\"\"\n\nimport rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\n\nclass MinimalClient(Node):\n    def __init__(self):\n        super().__init__('minimal_client')\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\n        # Wait for service to be available\n        while not self.cli.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Waiting for service...')\n        self.get_logger().info('Service found')\n\n    def send_request(self, a, b):\n        request = AddTwoInts.Request()\n        request.a = a\n        request.b = b\n        # Call service and wait for response\n        future = self.cli.call_async(request)\n        return future\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    minimal_client = MinimalClient()\n\n    # Send request: 5 + 3\n    future = minimal_client.send_request(5, 3)\n\n    # Wait for response\n    rclpy.spin_until_future_complete(minimal_client, future)\n    response = future.result()\n\n    minimal_client.get_logger().info(\n        f'Result of 5 + 3 = {response.sum}')\n\n    minimal_client.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"What's happening"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"create_client()"})," creates a client for the service"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"wait_for_service()"})," waits until the service is available"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"call_async()"})," sends the request asynchronously"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"spin_until_future_complete()"})," waits for the response"]}),"\n",(0,i.jsx)(n.li,{children:"The result is retrieved and printed"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"expected-output",children:"Expected Output"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Server terminal"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"[minimal_service] Service server started\n[minimal_service] Incoming request: 5 + 3 = 8\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Client terminal"}),":\n[minimal_client] Waiting for service...\n[minimal_client] Service found\n[minimal_client] Result of 5 + 3 = 8"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\n### Running Both Nodes\n\n**Terminal 1** (Server):\n```bash\npython3 simple_service_server.py\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Terminal 2"})," (Client):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"python3 simple_service_client.py\n"})}),"\n",(0,i.jsx)(n.p,{children:"The client will wait for the server, call the service, and receive the response."}),"\n",(0,i.jsx)(n.h2,{id:"services-vs-topics-a-robot-example",children:"Services vs Topics: A Robot Example"}),"\n",(0,i.jsx)(n.p,{children:"Imagine a robot arm controller:"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Using Topics (Wrong approach)"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:'Publisher sends "move to position" messages continuously'}),"\n",(0,i.jsx)(n.li,{children:"Subscriber tries to move"}),"\n",(0,i.jsx)(n.li,{children:"No confirmation of success"}),"\n",(0,i.jsx)(n.li,{children:"No way to know if the move completed"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Using Services (Correct approach)"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:'Client sends "move to position" request'}),"\n",(0,i.jsx)(n.li,{children:"Server confirms receipt and starts movement"}),"\n",(0,i.jsx)(n.li,{children:"Server waits for movement to complete"}),"\n",(0,i.jsx)(n.li,{children:'Server responds with "success: true/false"'}),"\n",(0,i.jsx)(n.li,{children:"Client continues only after getting response"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This is why robots use services for critical commands."}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"In this chapter, you learned:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Services provide ",(0,i.jsx)(n.strong,{children:"request-response"})," synchronous communication"]}),"\n",(0,i.jsxs)(n.li,{children:["Services are used for ",(0,i.jsx)(n.strong,{children:"commands"})," and ",(0,i.jsx)(n.strong,{children:"calculations"})]}),"\n",(0,i.jsxs)(n.li,{children:["Topics are used for ",(0,i.jsx)(n.strong,{children:"continuous streaming"})," data"]}),"\n",(0,i.jsx)(n.li,{children:"Service servers listen for requests and respond"}),"\n",(0,i.jsx)(n.li,{children:"Service clients send requests and wait for responses"}),"\n",(0,i.jsx)(n.li,{children:"Use services for critical, one-time operations"}),"\n",(0,i.jsx)(n.li,{children:"Use topics for continuous, non-blocking data flow"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Key Takeaway"}),": Services make robots deterministic\u2014you know when an operation completes."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Next steps"}),": In Chapter 3, we'll explore advanced node patterns including lifecycle management and parameterized nodes."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"References"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["ROS 2 Documentation Contributors. (2024). ",(0,i.jsx)(n.em,{children:"Understanding ROS 2 Services"}),". Retrieved from ",(0,i.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Understanding-ROS2-Services.html",children:"https://docs.ros.org/en/humble/Tutorials/Understanding-ROS2-Services.html"})]}),"\n",(0,i.jsxs)(n.li,{children:["ROS 2 Documentation Contributors. (2024). ",(0,i.jsx)(n.em,{children:"Understanding ROS 2 Actions"}),". Retrieved from ",(0,i.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Understanding-ROS2-Actions.html",children:"https://docs.ros.org/en/humble/Tutorials/Understanding-ROS2-Actions.html"})]}),"\n",(0,i.jsxs)(n.li,{children:["ROS 2 Examples. (2024). ",(0,i.jsx)(n.em,{children:"Services Example"}),". Retrieved from ",(0,i.jsx)(n.a,{href:"https://github.com/ros2/examples/tree/humble/rclpy_services",children:"https://github.com/ros2/examples/tree/humble/rclpy_services"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453:function(e,n,s){s.d(n,{R:function(){return c},x:function(){return l}});var r=s(6540);const i={},t=r.createContext(i);function c(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);