"use strict";(self.webpackChunkphysical_ai_humanoid_robotics_book=self.webpackChunkphysical_ai_humanoid_robotics_book||[]).push([[315],{1879:function(e,n,i){i.r(n),i.d(n,{assets:function(){return a},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return o},metadata:function(){return r},toc:function(){return c}});var r=JSON.parse('{"id":"module-1-ros2/03-advanced-nodes","title":"Chapter 3 - Advanced ROS 2 Nodes","description":"Introduction","source":"@site/docs/01-module-1-ros2/03-advanced-nodes.md","sourceDirName":"01-module-1-ros2","slug":"/module-1-ros2/03-advanced-nodes","permalink":"/native-book/module-1-ros2/03-advanced-nodes","draft":false,"unlisted":false,"editUrl":"https://github.com/native-book/native-book/tree/main/docs/01-module-1-ros2/03-advanced-nodes.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"03-advanced-nodes","title":"Chapter 3 - Advanced ROS 2 Nodes","sidebar_label":"Chapter 3: Advanced Nodes"},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 2: Services","permalink":"/native-book/module-1-ros2/02-services"},"next":{"title":"Chapter 4: Gazebo Basics","permalink":"/native-book/module-2-digital-twin/04-gazebo-fundamentals"}}'),s=i(4848),t=i(8453);const o={id:"03-advanced-nodes",title:"Chapter 3 - Advanced ROS 2 Nodes",sidebar_label:"Chapter 3: Advanced Nodes"},l="Chapter 3: Advanced ROS 2 Nodes",a={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Why Advanced Patterns?",id:"why-advanced-patterns",level:3},{value:"Lifecycle Nodes",id:"lifecycle-nodes",level:2},{value:"Why Lifecycles Matter",id:"why-lifecycles-matter",level:3},{value:"Simple Lifecycle Node",id:"simple-lifecycle-node",level:3},{value:"Parameters: Configurable Nodes",id:"parameters-configurable-nodes",level:2},{value:"Quality of Service (QoS)",id:"quality-of-service-qos",level:2},{value:"Namespacing: Multiple Nodes",id:"namespacing-multiple-nodes",level:2},{value:"Expected Output",id:"expected-output",level:2},{value:"Putting It All Together",id:"putting-it-all-together",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"chapter-3-advanced-ros-2-nodes",children:"Chapter 3: Advanced ROS 2 Nodes"})}),"\n",(0,s.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,s.jsx)(n.p,{children:"In Chapters 1 and 2, you created simple nodes that run indefinitely. But real robots need more sophisticated node management:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"How do I cleanly start and stop nodes?"}),"\n",(0,s.jsx)(n.li,{children:"How do I configure a node at runtime?"}),"\n",(0,s.jsx)(n.li,{children:"How do I control message delivery guarantees?"}),"\n",(0,s.jsx)(n.li,{children:"How do I run multiple instances of the same node?"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"In this chapter, you'll learn advanced node patterns that make ROS 2 systems robust and production-ready."}),"\n",(0,s.jsx)(n.h3,{id:"why-advanced-patterns",children:"Why Advanced Patterns?"}),"\n",(0,s.jsx)(n.p,{children:"Simple nodes work for tutorials, but production systems need:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Lifecycle Management"}),": Start, configure, activate, and deactivate nodes cleanly"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Quality of Service (QoS)"}),": Control message reliability and history"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Namespacing"}),": Run multiple robots or systems without conflicts"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Parameters"}),": Configure nodes without code changes"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Source"}),": ROS 2 Documentation Contributors. (2024). ",(0,s.jsx)(n.em,{children:"Understanding ROS 2 Node Lifecycles"}),". Retrieved from ",(0,s.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Understanding-ROS2-Node-Lifecycle.html",children:"https://docs.ros.org/en/humble/Tutorials/Understanding-ROS2-Node-Lifecycle.html"})]}),"\n",(0,s.jsx)(n.h2,{id:"lifecycle-nodes",children:"Lifecycle Nodes"}),"\n",(0,s.jsxs)(n.p,{children:["A ",(0,s.jsx)(n.strong,{children:"lifecycle node"})," goes through distinct states:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"[Unconfigured] \u2192 [Inactive] \u2192 [Active] \u2192 [Finalized]\n      \u2191              \u2191           \u2191\n  Created      Configured    Running\n"})}),"\n",(0,s.jsx)(n.p,{children:"Each state transition can trigger initialization, cleanup, or error handling code."}),"\n",(0,s.jsx)(n.h3,{id:"why-lifecycles-matter",children:"Why Lifecycles Matter"}),"\n",(0,s.jsx)(n.p,{children:"Imagine starting a robot:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Unconfigured"}),": Node created but not ready (no resources allocated)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Inactive"}),": Node configured but not processing (ready to start)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Active"}),": Node running and processing data (controlling robot)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Finalized"}),": Node cleanup complete (resources released)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This allows coordinated startup sequences. For example:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Start all perception nodes first (Active)"}),"\n",(0,s.jsx)(n.li,{children:"Then start control nodes (Active)"}),"\n",(0,s.jsx)(n.li,{children:"If perception fails, disable control nodes (inactive) without crashing"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"simple-lifecycle-node",children:"Simple Lifecycle Node"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\"\"\"\nSimple ROS 2 Lifecycle Node\nDemonstrates state transitions\n\"\"\"\n\nimport rclpy\nfrom rclpy.lifecycle import Node, TransitionCallbackReturn\nfrom rclpy.lifecycle import State\nfrom rclpy_lifecycle.msg import TransitionEvent\n\n\nclass MinimalLifecycleNode(Node):\n    def __init__(self):\n        # Use LifecycleNode instead of Node\n        super().__init__('minimal_lifecycle_node')\n        self.publisher = None\n\n    def on_configure(self, state: State) -> TransitionCallbackReturn:\n        # Called when transitioning: Unconfigured \u2192 Inactive\n        # Allocate resources here\n        self.get_logger().info('Configuring...')\n        self.publisher = self.create_publisher(String, 'topic', 10)\n        self.get_logger().info('Configuration complete')\n        return TransitionCallbackReturn.SUCCESS\n\n    def on_activate(self, state: State) -> TransitionCallbackReturn:\n        # Called when transitioning: Inactive \u2192 Active\n        # Start processing\n        self.get_logger().info('Activating...')\n        # Start timer or begin processing\n        return TransitionCallbackReturn.SUCCESS\n\n    def on_deactivate(self, state: State) -> TransitionCallbackReturn:\n        # Called when transitioning: Active \u2192 Inactive\n        # Stop processing (but keep resources allocated)\n        self.get_logger().info('Deactivating...')\n        return TransitionCallbackReturn.SUCCESS\n\n    def on_cleanup(self, state: State) -> TransitionCallbackReturn:\n        # Called when transitioning: Inactive \u2192 Unconfigured\n        # Release resources\n        self.get_logger().info('Cleaning up...')\n        # Destroy publisher, subscriptions, etc.\n        return TransitionCallbackReturn.SUCCESS\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    minimal_lifecycle_node = MinimalLifecycleNode()\n    rclpy.spin(minimal_lifecycle_node)\n    minimal_lifecycle_node.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"What's happening"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"on_configure()"})," is called when starting the node (allocate resources)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"on_activate()"})," is called when enabling the node (start processing)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"on_deactivate()"})," is called when pausing the node (stop processing)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"on_cleanup()"})," is called when stopping the node (release resources)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Each callback can return SUCCESS or FAILURE, allowing error handling."}),"\n",(0,s.jsx)(n.h2,{id:"parameters-configurable-nodes",children:"Parameters: Configurable Nodes"}),"\n",(0,s.jsxs)(n.p,{children:["Instead of hardcoding values, use ",(0,s.jsx)(n.strong,{children:"parameters"})," to configure nodes:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\"\"\"\nROS 2 Node with Parameters\nConfigure behavior without code changes\n\"\"\"\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\n\nclass ConfigurableNode(Node):\n    def __init__(self):\n        super().__init__('configurable_node')\n\n        # Declare parameters with default values\n        self.declare_parameter('message_prefix', 'Data')\n        self.declare_parameter('publish_rate', 1.0)  # Hz\n        self.declare_parameter('message_count', 100)\n\n        # Get parameter values\n        self.prefix = self.get_parameter('message_prefix').value\n        self.rate = self.get_parameter('publish_rate').value\n        self.count = self.get_parameter('message_count').value\n\n        self.get_logger().info(\n            f'Prefix: {self.prefix}, Rate: {self.rate}Hz, Count: {self.count}')\n\n        # Create publisher\n        self.publisher = self.create_publisher(String, 'topic', 10)\n\n        # Create timer with configured rate\n        timer_period = 1.0 / self.rate\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n        self.counter = 0\n\n    def timer_callback(self):\n        # Publish with configured prefix\n        msg = String()\n        msg.data = f'{self.prefix}: {self.counter}'\n        self.publisher.publish(msg)\n        self.counter += 1\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    configurable_node = ConfigurableNode()\n    rclpy.spin(configurable_node)\n    configurable_node.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Running with custom parameters"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Use default parameters\nros2 run package configurable_node\n\n# Override parameters at runtime\nros2 run package configurable_node \\\n  --ros-args \\\n  -p message_prefix:='Sensor' \\\n  -p publish_rate:=10.0\n"})}),"\n",(0,s.jsx)(n.p,{children:"This allows configuring nodes without modifying code."}),"\n",(0,s.jsx)(n.h2,{id:"quality-of-service-qos",children:"Quality of Service (QoS)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"QoS"})," controls how messages are delivered:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from rclpy.qos import QoSProfile, ReliabilityPolicy, HistoryPolicy\n\n# Best effort (fast, may lose messages)\nqos_fast = QoSProfile(\n    reliability=ReliabilityPolicy.BEST_EFFORT,\n    history=HistoryPolicy.KEEP_LAST,\n    depth=5\n)\n\n# Reliable (slower, guarantees delivery)\nqos_reliable = QoSProfile(\n    reliability=ReliabilityPolicy.RELIABLE,\n    history=HistoryPolicy.KEEP_ALL,\n    depth=100\n)\n\n# Use when creating publishers/subscribers\nself.create_publisher(String, 'topic', qos_reliable)\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"When to use each"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"BEST_EFFORT"}),": High-frequency data (cameras, LiDAR) - losing a frame is OK"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"RELIABLE"}),": Critical data (commands, state changes) - must not lose messages"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"namespacing-multiple-nodes",children:"Namespacing: Multiple Nodes"}),"\n",(0,s.jsxs)(n.p,{children:["Run multiple robots without conflicts using ",(0,s.jsx)(n.strong,{children:"namespaces"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Robot 1\nros2 run package node --ros-args -n /robot1\n\n# Robot 2\nros2 run package node --ros-args -n /robot2\n\n# Now topics are:\n# /robot1/topic\n# /robot2/topic\n"})}),"\n",(0,s.jsx)(n.p,{children:"This is how you run multiple robots on the same ROS 2 network."}),"\n",(0,s.jsx)(n.h2,{id:"expected-output",children:"Expected Output"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Lifecycle Node"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"[minimal_lifecycle_node] Configuring...\n[minimal_lifecycle_node] Configuration complete\n[minimal_lifecycle_node] Activating...\n[minimal_lifecycle_node] Running...\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Configurable Node"})," (with custom parameters):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"[configurable_node] Prefix: Sensor, Rate: 10.0Hz, Count: 100\n[configurable_node] Publishing: Sensor: 0\n[configurable_node] Publishing: Sensor: 1\n[configurable_node] Publishing: Sensor: 2\n...\n"})}),"\n",(0,s.jsx)(n.h2,{id:"putting-it-all-together",children:"Putting It All Together"}),"\n",(0,s.jsx)(n.p,{children:"A production robot node combines all three:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Lifecycle"}),": Configure on startup, activate when ready"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Parameters"}),": Allow runtime configuration"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"QoS"}),": Choose appropriate reliability for each topic"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"class RobotControlNode(LifecycleNode):\n    def on_configure(self, state: State):\n        # Declare parameters\n        self.declare_parameter('joint_speed', 0.5)\n\n        # Create publishers with reliable QoS for commands\n        qos_reliable = QoSProfile(\n            reliability=ReliabilityPolicy.RELIABLE)\n        self.cmd_pub = self.create_publisher(\n            JointCommand, 'joint_commands', qos_reliable)\n\n        # Create subscriptions with best effort for sensor data\n        qos_fast = QoSProfile(\n            reliability=ReliabilityPolicy.BEST_EFFORT)\n        self.sensor_sub = self.create_subscription(\n            JointState, 'joint_states', self.sensor_callback, qos_fast)\n\n        return TransitionCallbackReturn.SUCCESS\n"})}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(n.p,{children:"In this chapter, you learned:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Lifecycle Nodes"}),": Coordinate startup and shutdown with state transitions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Parameters"}),": Configure nodes at runtime without code changes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Quality of Service"}),": Control message reliability and delivery"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Namespacing"}),": Run multiple nodes without conflicts"]}),"\n",(0,s.jsx)(n.li,{children:"Production-ready systems combine all three patterns"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Key Takeaway"}),": Advanced nodes make ROS 2 systems scalable, reliable, and maintainable."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Next steps"}),": You've completed Module 1! The next modules will build on these foundations with simulation, perception, and AI integration."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"References"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["ROS 2 Documentation Contributors. (2024). ",(0,s.jsx)(n.em,{children:"Understanding ROS 2 Node Lifecycles"}),". Retrieved from ",(0,s.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Understanding-ROS2-Node-Lifecycle.html",children:"https://docs.ros.org/en/humble/Tutorials/Understanding-ROS2-Node-Lifecycle.html"})]}),"\n",(0,s.jsxs)(n.li,{children:["ROS 2 Documentation Contributors. (2024). ",(0,s.jsx)(n.em,{children:"Parameters in ROS 2"}),". Retrieved from ",(0,s.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Parameters.html",children:"https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Parameters.html"})]}),"\n",(0,s.jsxs)(n.li,{children:["ROS 2 Documentation Contributors. (2024). ",(0,s.jsx)(n.em,{children:"Quality of Service Settings"}),". Retrieved from ",(0,s.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Concepts/Advanced/QoS-Settings.html",children:"https://docs.ros.org/en/humble/Concepts/Advanced/QoS-Settings.html"})]}),"\n",(0,s.jsxs)(n.li,{children:["ROS 2 Lifecycle Documentation. (2024). Retrieved from ",(0,s.jsx)(n.a,{href:"https://github.com/ros2-lifecycle",children:"https://github.com/ros2-lifecycle"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:function(e,n,i){i.d(n,{R:function(){return o},x:function(){return l}});var r=i(6540);const s={},t=r.createContext(s);function o(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);